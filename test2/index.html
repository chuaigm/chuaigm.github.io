<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件处理工具</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #progress-bar { width: 100%; background-color: #f3f3f3; }
        #progress { width: 0%; height: 20px; background-color: #4caf50; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
    <h1>文件处理工具</h1>
    <input type="file" id="fileInput" webkitdirectory mozdirectory multiple>
    <button id="processButton">开始处理</button>
    <div id="progress-bar" style="display:none;">
        <div id="progress"></div>
    </div>
    <a id="downloadLink" style="display:none;" href="#">下载ZIP文件</a>

    <script>
        document.getElementById('processButton').addEventListener('click', function () {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                alert('请选择一个目录');
                return;
            }

            // 获取平台目录中的文件
            const files = Array.from(fileInput.files);
            const covers = files.filter(file => file.webkitRelativePath.includes('covers'));

            if (covers.length === 0) {
                alert('covers文件夹不存在');
                return;
            }

            // 显示进度条
            document.getElementById('progress-bar').style.display = 'block';
            const progress = document.getElementById('progress');
            const zip = new JSZip();
            let processedCount = 0;

            covers.forEach((file, index) => {
                const fileName = file.name;
                const folderName = file.webkitRelativePath.split('/')[1]; // 获取文件夹名
                const folderPath = folderName ? folderName : 'defaultFolder';

                // 读取文件内容
                const reader = new FileReader();
                reader.onload = function (e) {
                    const content = e.target.result;

                    // 在zip中创建文件夹并将文件添加进去
                    zip.folder(folderPath).file('cover.jpg', content);

                    // 更新进度条
                    processedCount++;
                    const progressPercentage = (processedCount / covers.length) * 100;
                    progress.style.width = `${progressPercentage}%`;

                    // 处理完毕后
                    if (processedCount === covers.length) {
                        zip.generateAsync({ type: 'blob' }).then(function (blob) {
                            const url = URL.createObjectURL(blob);
                            const downloadLink = document.getElementById('downloadLink');
                            downloadLink.href = url;
                            downloadLink.download = 'platform.zip';
                            downloadLink.style.display = 'inline-block';
                            alert('文件处理完成，点击下载按钮下载ZIP文件');
                        });
                    }
                };
                reader.readAsArrayBuffer(file);
            });
        });
    </script>
</body>
</html>